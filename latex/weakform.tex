In the following we will use $\varphi/\psi$ to denote node ansatz functions with linear/quadratic master basis functions, respectively.
We define the spaces
\begin{align*}
	\H^1 &:= \langle \psi_1,\ldots,\psi_{N_P} \rangle \subset C^1(\Or)\\
	\H^2 &:= \langle \varphi_1,\ldots,\varphi_N \rangle \subset C^2(\Or)
\end{align*} 
For discretization we will use Taylor-Hood elements, which means $\chi\in\H^2, p\in\H^1$ via
\begin{align}
	\chi(X,t) &= \sumi \vc_i(t)\varphi_i(X), && \vc_i(t):[0,T] \to\R^3.\label{def:chi}\\
	p(X,t) &= \sumiP d_i(t)\psi_i(X), && d_i(t):[0,T] \to\R.
\end{align}
This means we have quadratic ansatz functions for positions, velocity and linear functions for pressure.
With \eqref{def:chi} we deduce the discrete quantities
\begin{align*}
	\vV(X,t) &= \d{\chi}{t}(X,t) = \sumi \vc_i'(t)\varphi_i(X)\\
	\vA(X,t) &= \d{\vV}{t}(X,t) = \sumi \vc_i''(t)\varphi_i(X)\\
	\vF(X,t) &= \d{\chi}{X}(X,t) = \m{\grad \chi_1(X,t)\\ \grad \chi_2(X,t)\\ \grad \chi_3(X,t)}
		   = \sumi\m{c_{i,1}\d{\varphi_i}{X_1} & \dots & c_{i,1}\d{\varphi_i}{X_3}\\
		   				\vdots & \ddots & \vdots\\
		   				c_{i,3}\d{\varphi_i}{X_1} & \dots & c_{i,3}\d{\varphi_i}{X_3}}\\
		   &=\sumi \vc_i(t)\cdot \grad\varphi_i(X) = \sumi \vc_i(t)\otimes \dpi.
\end{align*}

Now, equation \eqref{def:maineq} (without body forces) and the incompressibility constraint give the system 
\begin{align}
	\rho_0(X)\d{\vV}{t}(X,t) &= \divergence\vP(X,t) && \fo X\in\Or,\label{def:maineq_nobodyforce}\\
	J(X,t) &= 1 && \fo X\in\Or,\label{def:maineq_cond}
\end{align}
for which we have the spatial weak form
\begin{align}
	\intor\rho_0(X)\d{\vV}{t}(X,t)\varphi(X)dX &= \intor\divergence\vP(X,t)\varphi(X)dX &&\fo \varphi\in\H^2\\
	\intor (J(X,t)-1)\psi(X)dX &= 0 && \fo \psi\in\H^1
\end{align}
The right hand side of \eqref{def:maineq_nobodyforce} can be transformed as
\begin{align*}
	\intor \div{\vP(X,t)}\varphi(X) dX &= \intor \div{\vP(X,t)\varphi(X)} - \vP(X,t)\divergence\varphi(X) dX\\
		 &= \underbrace{\intorb \vP(X,t)\varphi(X) dN}_{=0} - \intor \vP(X,t)\divergence\varphi(X)dX\\
		 &= \intor -\vP(X,t)\divergence\varphi(X) dX.
\end{align*}
Now, to satisfy equations \eqref{def:maineq_nobodyforce} and \eqref{def:maineq_cond}, they must hold true for every node basis function. 
Consequently, we obtain a system of $3N+N_P$ equations
\begin{align}
	\intor \rho_0(X)\d{\vV}{t}(X,t)\varphi_k(X)dX + \intor\vP(X,t)\dpk dX &= \vnull, && \fo k=1\ldots N,\label{def:weakform}\\
	\intor (J(X,t)-1)\psi_k(X)dX &= 0, && \fo k=1\ldots N_P.\label{def:weakform_nb}
\end{align}

\subsubsection{Integrals of main equation parts}
In the following we fix a $k\in\{1,\ldots, N\}$.
Then, by \eqref{eq:fphidx}, the first summand of \eqref{def:weakform} reads as
\begin{align}
	\intor \rho_0(X)\d{\vV}{t}(X,t)\varphi_k(X)dX\nonumber
		&\re{eq:fphidx} \sumvk\sumgp w_p \rho_0(\pmp)\d{\vV}{t}(\pmp,t)\Nkmp\jmp\nonumber\\
		&= \sumvk\sumgp w_p \rho_0(\pmp)\sumi \vc_i''(t)\varphi_i(\pmp) \Nkmp\jmp\nonumber\\
		&= \sumi \vc_i''(t)\sumvk\sumgp w_p \rho_0(\pmp)N_{l(i,m)}(X_p) \Nkmp\jmp\label{def:discreteVphidX}
\end{align}
Similarly, the second summand of \eqref{def:weakform} writes as
\begin{align}
		\intor\vP(X,t)\dpk dX &\re{eq:fgradphidx} \sumvk\sumgp w_p\vP(\pmp,t)\dNkmp\jmp.\label{def:discretePgradphidX}
\end{align}
Finally, for $k\in\{1\ldots N_P\}$, condition \eqref{def:maineq_cond} formulates to
\begin{align}
	\intor (J(X,t)-1)\psi_k(X)dX &= \sumvk\sumgp w_p (\det\vF(\pmp,t)-1) \Nkmp\jmp\label{eq:weak_incomp_condition}\\
	&= \sumvk\sumgp w_p \left(\det\left(\sumi \vc_i(t)\otimes \divergence\varphi_i(\pmp)\right)-1\right) \Nkmp\jmp.\nonumber
\end{align}

\subsubsection{Local tensor evaluations}
The most elaborative part is to evaluate the stress tensor $\vP$ at all volumes and Gauss points.
We have from \eqref{def:completeP} that
\begin{align*}
		\vP(\pmp,t) &= p(\pmp,t)\vF^{-T}(\pmp,t) + 2(c_{10} + I_1(\vC(\pmp,t))c_{01})\vF(\pmp,t)\\
			 &- 2c_{01}\vF(\pmp,t)\vC(\pmp,t)+g(\lambda_f(\pmp,t))\vF(\pmp,t)\va_0(\pmp)\otimes\va_0(\pmp).
\end{align*}
In the following we derive representations of the various components of $\vP$, where we assume $X\in\Or$.
\begin{align*}
	\vF(\pmp,t) &= \sumi \vc_i(t)\otimes \dNimp,\\
	I_1(\vC(X,t)) &= \tr\vC(X,t) = \tr(\vF(X,t)^T\vF(X,t)) = \vF(X,t) : \vF(X,t)\\
	&= \sumi \vc_i(t)\otimes \dpi : \sumi \vc_i(t)\otimes \dpi\\
	&= \sumi\sumj \left(\vc_i(t)\otimes \dpi\right) : (\vc_j(t)\otimes \dpj)\\
	&= \sumi\sumj (\vc_i(t) \cdot \vc_j(t))(\dpi \cdot \dpj),\\
	\Rightarrow I_1(\vC(\pmp,t)) &= \sumi\sumj (\vc_i(t) \cdot \vc_j(t))(\dNimp \cdot \dNjmp),\\
\end{align*}
\begin{align*}
	\vF(X,t)^T\vF(X,t) &= \sumi\sumj \bigl(\vc_i(t)\otimes\dpi\bigr)^T\vc_j(t)\otimes\dpj\\
	 &= \sumi\sumj \bigl(\dpi\otimes\vc_i(t)\bigr)\vc_j(t)\otimes\dpj\\
	 &=\sumi\sumj (\vc_i(t)\cdot \vc_j(t))\dpi\otimes\dpj,\\
	\lambda_f(X,t)^2 &=I_4(\vC(X,t),\va_0(X)) = \vC(X,t):(\va_0(X)\otimes \va_0(X))\\
			&=  \vF(X,t)^T\vF(X,t) : (\va_0(X)\otimes \va_0(X))\\
			&=  \sumi\sumj (\vc_i(t)\cdot \vc_j(t))\bigl(\dpi\otimes\dpj\bigr) : (\va_0(X)\otimes \va_0(X))\\
			&=  \sumi\sumj (\vc_i(t)\cdot \vc_j(t))\left(\dpi\cdot \va_0(X)\right)(\dpj\cdot \va_0(X)),\\
	\Rightarrow \lambda_f(\pmp,t) &=
    		\left(\sumi\sumj (\vc_i(t)\cdot \vc_j(t))\left(\dNimp\cdot \va_0(\pmp)\right)(\dNjmp\cdot \va_0(\pmp))\right)^\frac{1}{2},\\
\end{align*}
\begin{align*}
    \vF(X,t)(\va_0(X)\otimes\va_0(X)) &= \sumi (\vc_i(t)\otimes \dpi)(\va_0(X)\otimes\va_0(X))\\
    &= \sumi (\vc_i(t)\otimes \va_0(X))(\dpi\cdot\va_0(X)),\\
    \Rightarrow \vF(\pmp,t)(\va_0(\pmp)\otimes\va_0(\pmp)) 
    	&= \sumi (\vc_i(t)\otimes \va_0(\pmp))(\dNimp\cdot\va_0(\pmp)).\\
\end{align*}

\begin{align*}
	\d{\lambda_f}{t}(X,t) &= \frac{1}{2\lambda_f(X,t)} \suml{i,j}{N} (\vc'_i(t)\cdot \vc_j(t) + \vc_i(t)\cdot \vc'_j(t))\left(\dpi\cdot a_0(X)\right)(\dpj\cdot a_0(X))\\
		&= \frac{1}{\lambda_f(X,t)}\suml{i,j}{N} (\vc_i(t)\cdot \vc'_j(t))\left(\dpi\cdot a_0(X)\right)(\dpj\cdot a_0(X))
\end{align*}
%     \vF(X,t)\vF(X,t)^T\vF(X,t) &= \sumk\vc_k(t)\otimes\dpk\sumi\sumj (\vc_i(t)\cdot \vc_j(t))\dpi\otimes\dpj\nonumber\\
%     	&= \suml{i,j,k}{N}(\vc_i(t)\cdot \vc_j(t))(\vc_k(t)\otimes\dpk)\dpi\otimes\dpj\nonumber\\
%     	&= \suml{i,j,k}{N}(\vc_i(t)\cdot \vc_j(t))(\dpk\cdot\dpi)(\vc_k(t)\otimes\dpj)\nonumber\\

% 	\vF(\pmp,t)\vC(\pmp,t) &= \vF(\pmp,t)\vF(\pmp,t)^T\vF(\pmp,t)\\
%     	&= \suml{i,j,k}{N}(\vc_i(t)\cdot \vc_j(t))(\divergence\varphi_k(\pmp)\cdot\divergence\varphi_i(\pmp))(\vc_k(t)\otimes\divergence\varphi_j(\pmp))\\
	%&= \suml{i,j,q\in E_m}{}(\vc_i(t)\cdot \vc_j(t))(\nabla N_{l(q,m)}(X_p)\cdot\nabla N_{l(i,m)}(X_p))(\vc_q(t)\otimes\nabla N_{l(j,m)}(X_p))\\
	%&= \suml{i,j\in E_m}{} (\vc_i(t)\cdot \vc_j(t))\left(\nabla N_{l(i,m)}(X_p)\cdot a_0(\pmp)\right)(\nabla N_{l(j,m)}(X_p))\cdot a_0(\pmp))\nonumber
	%&= \suml{i\in E_m}{} (\vc_i(t)\otimes \va_0(\pmp))(\nabla N_{l(i,m)}(X_p)\cdot\va_0(\pmp))\nonumber